<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agri IoT Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .main-content {
            padding: 30px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e0e0e0;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .sensor-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #4CAF50;
            margin: 10px 0;
        }

        .sensor-unit {
            font-size: 1.2em;
            color: #666;
            margin-left: 10px;
        }

        .motor-control {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .switch-container:hover {
            background: #e9ecef;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #4CAF50;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .schedule-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: linear-gradient(135deg, #45a049 0%, #4CAF50 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .schedule-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .schedule-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #4CAF50;
        }

        .schedule-item:hover {
            background: #e9ecef;
        }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }

        .delete-btn:hover {
            background: #d32f2f;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .connection-status.disconnected {
            background: #ffebee;
        }

        .connection-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4CAF50;
        }

        .connection-status.disconnected .connection-dot {
            background: #f44336;
        }

        .logs {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .log-time {
            color: #666;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± Agri IoT Platform</h1>
            <p>Smart Agriculture Device Control & Monitoring</p>
        </div>

        <div class="main-content">
            <div class="connection-status" id="connectionStatus">
                <div class="connection-dot"></div>
                <span id="connectionText">Connected to MQTT Broker</span>
            </div>

            <div class="grid">
                <!-- Sensor Monitoring -->
                <div class="card">
                    <h3>
                        <span class="status-indicator"></span>
                        Environmental Sensors
                    </h3>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div style="text-align: center;">
                            <div>üå°Ô∏è Temperature</div>
                            <div class="sensor-value" id="temperature">24.5<span class="sensor-unit">¬∞C</span></div>
                        </div>
                        <div style="text-align: center;">
                            <div>üíß Humidity</div>
                            <div class="sensor-value" id="humidity">65<span class="sensor-unit">%</span></div>
                        </div>
                    </div>
                    <div style="font-size: 0.9em; color: #666;">
                        Last updated: <span id="lastUpdated">Just now</span>
                    </div>
                </div>

                <!-- Manual Motor Control -->
                <div class="card">
                    <h3>‚öôÔ∏è Manual Motor Control</h3>
                    <div class="motor-control">
                        <div class="switch-container">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 5px;">Water Pump Motor</div>
                                <div style="font-size: 0.9em; color: #666;">Current Status: <span id="motorStatus">OFF</span></div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="motorSwitch">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <button class="btn" onclick="emergencyStop()">üõë Emergency Stop</button>
                    </div>
                </div>

                <!-- Schedule Management -->
                <div class="card">
                    <h3>üìÖ Schedule Management</h3>
                    <form class="schedule-form" onsubmit="addSchedule(event)">
                        <div class="form-group">
                            <label for="scheduleTime">Time</label>
                            <input type="time" id="scheduleTime" required>
                        </div>
                        <div class="form-group">
                            <label for="scheduleAction">Action</label>
                            <select id="scheduleAction" required>
                                <option value="on">Turn ON</option>
                                <option value="off">Turn OFF</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="scheduleDuration">Duration (minutes)</label>
                            <input type="number" id="scheduleDuration" min="1" max="1440" placeholder="e.g., 30">
                        </div>
                        <button type="submit" class="btn">Add Schedule</button>
                    </form>
                </div>

                <!-- Active Schedules -->
                <div class="card">
                    <h3>‚è∞ Active Schedules</h3>
                    <div class="schedule-list" id="scheduleList">
                        <!-- Schedules will be populated here -->
                    </div>
                </div>
            </div>

            <!-- System Logs -->
            <div class="card">
                <h3>üìã System Logs</h3>
                <div class="logs" id="systemLogs">
                    <!-- Logs will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simulated MQTT client and system state
        class AgriIoTPlatform {
            constructor() {
                this.mqttConnected = true;
                this.motorState = false;
                this.schedules = [];
                this.logs = [];
                this.sensorData = {
                    temperature: 24.5,
                    humidity: 65
                };
                
                this.initializeUI();
                this.startSensorSimulation();
                this.startScheduleChecker();
            }

            initializeUI() {
                const motorSwitch = document.getElementById('motorSwitch');
                motorSwitch.addEventListener('change', (e) => {
                    this.controlMotor(e.target.checked);
                });

                this.updateUI();
                this.loadSchedules();
            }

            // Simulate MQTT communication
            publishMQTT(topic, message) {
                this.addLog(`MQTT Publish: ${topic} = ${message}`);
                // In real implementation, this would send to actual MQTT broker
            }

            subscribeMQTT(topic) {
                this.addLog(`MQTT Subscribe: ${topic}`);
                // In real implementation, this would subscribe to actual MQTT broker
            }

            controlMotor(state) {
                this.motorState = state;
                this.publishMQTT('agri/motor/control', state ? 'ON' : 'OFF');
                this.updateMotorStatus();
                this.addLog(`Motor ${state ? 'started' : 'stopped'} manually`);
            }

            emergencyStop() {
                this.motorState = false;
                document.getElementById('motorSwitch').checked = false;
                this.publishMQTT('agri/motor/emergency', 'STOP');
                this.updateMotorStatus();
                this.addLog('Emergency stop activated!');
            }

            addSchedule(event) {
                event.preventDefault();
                
                const time = document.getElementById('scheduleTime').value;
                const action = document.getElementById('scheduleAction').value;
                const duration = document.getElementById('scheduleDuration').value;

                const schedule = {
                    id: Date.now(),
                    time: time,
                    action: action,
                    duration: parseInt(duration) || 0,
                    active: true
                };

                this.schedules.push(schedule);
                this.saveSchedules();
                this.renderSchedules();
                this.addLog(`Schedule added: ${action.toUpperCase()} at ${time}`);
                
                // Reset form
                document.getElementById('scheduleTime').value = '';
                document.getElementById('scheduleDuration').value = '';
            }

            deleteSchedule(id) {
                this.schedules = this.schedules.filter(s => s.id !== id);
                this.saveSchedules();
                this.renderSchedules();
                this.addLog(`Schedule deleted`);
            }

            checkSchedules() {
                const now = new Date();
                const currentTime = now.getHours().toString().padStart(2, '0') + ':' + 
                                  now.getMinutes().toString().padStart(2, '0');

                this.schedules.forEach(schedule => {
                    if (schedule.time === currentTime && schedule.active) {
                        this.executeSchedule(schedule);
                    }
                });
            }

            executeSchedule(schedule) {
                const action = schedule.action === 'on';
                this.controlMotor(action);
                document.getElementById('motorSwitch').checked = action;
                
                if (schedule.duration > 0 && action) {
                    setTimeout(() => {
                        this.controlMotor(false);
                        document.getElementById('motorSwitch').checked = false;
                        this.addLog(`Scheduled motor stopped after ${schedule.duration} minutes`);
                    }, schedule.duration * 60000);
                }

                this.addLog(`Schedule executed: ${schedule.action.toUpperCase()} at ${schedule.time}`);
            }

            startSensorSimulation() {
                setInterval(() => {
                    // Simulate sensor readings
                    this.sensorData.temperature = (20 + Math.random() * 15).toFixed(1);
                    this.sensorData.humidity = (40 + Math.random() * 40).toFixed(0);
                    
                    this.updateSensorDisplay();
                    this.publishMQTT('agri/sensors/temperature', this.sensorData.temperature);
                    this.publishMQTT('agri/sensors/humidity', this.sensorData.humidity);
                }, 5000);
            }

            startScheduleChecker() {
                setInterval(() => {
                    this.checkSchedules();
                }, 60000); // Check every minute
            }

            updateSensorDisplay() {
                document.getElementById('temperature').innerHTML = 
                    `${this.sensorData.temperature}<span class="sensor-unit">¬∞C</span>`;
                document.getElementById('humidity').innerHTML = 
                    `${this.sensorData.humidity}<span class="sensor-unit">%</span>`;
                document.getElementById('lastUpdated').textContent = 
                    new Date().toLocaleTimeString();
            }

            updateMotorStatus() {
                document.getElementById('motorStatus').textContent = this.motorState ? 'ON' : 'OFF';
            }

            updateUI() {
                this.updateSensorDisplay();
                this.updateMotorStatus();
                this.updateConnectionStatus();
            }

            updateConnectionStatus() {
                const statusEl = document.getElementById('connectionStatus');
                const textEl = document.getElementById('connectionText');
                
                if (this.mqttConnected) {
                    statusEl.classList.remove('disconnected');
                    textEl.textContent = 'Connected to MQTT Broker';
                } else {
                    statusEl.classList.add('disconnected');
                    textEl.textContent = 'Disconnected from MQTT Broker';
                }
            }

            renderSchedules() {
                const container = document.getElementById('scheduleList');
                container.innerHTML = '';

                if (this.schedules.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666;">No schedules configured</p>';
                    return;
                }

                this.schedules.forEach(schedule => {
                    const scheduleEl = document.createElement('div');
                    scheduleEl.className = 'schedule-item';
                    scheduleEl.innerHTML = `
                        <div>
                            <strong>${schedule.time}</strong> - ${schedule.action.toUpperCase()}
                            ${schedule.duration > 0 ? ` (${schedule.duration} min)` : ''}
                        </div>
                        <button class="delete-btn" onclick="platform.deleteSchedule(${schedule.id})">Delete</button>
                    `;
                    container.appendChild(scheduleEl);
                });
            }

            addLog(message) {
                const timestamp = new Date().toLocaleTimeString();
                this.logs.unshift({ time: timestamp, message: message });
                
                // Keep only last 50 logs
                if (this.logs.length > 50) {
                    this.logs = this.logs.slice(0, 50);
                }
                
                this.renderLogs();
            }

            renderLogs() {
                const container = document.getElementById('systemLogs');
                container.innerHTML = '';

                this.logs.forEach(log => {
                    const logEl = document.createElement('div');
                    logEl.className = 'log-entry';
                    logEl.innerHTML = `<span class="log-time">[${log.time}]</span> ${log.message}`;
                    container.appendChild(logEl);
                });
            }

            saveSchedules() {
                // In a real implementation, this would save to a database
                // For demo purposes, we'll store in memory
            }

            loadSchedules() {
                // In a real implementation, this would load from a database
                this.renderSchedules();
            }
        }

        // Global functions for HTML event handlers
        function emergencyStop() {
            platform.emergencyStop();
        }

        function addSchedule(event) {
            platform.addSchedule(event);
        }

        // Initialize the platform
        const platform = new AgriIoTPlatform();

        // Initial log
        platform.addLog('System initialized successfully');
        platform.addLog('MQTT client connected to broker');
        platform.addLog('Sensor monitoring started');
    </script>
</body>
</html>